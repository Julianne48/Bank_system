{% extends "base.html" %}
{% block content %}
<h2>账户详情 - {{ account.name }} （{{ account.bank_number }}）</h2>
<p>余额：{{ account.balance }}</p>

<h3>存款</h3>
<form method="post" action="{{ url_for('main.deposit') }}">
  <input type="hidden" name="acc_id" value="{{ account.id }}">
  <label>金额: <input type="number" step="0.01" min="0" name="amount" required></label>
  <button type="submit">存入</button>
</form>

<h3>取款</h3>
<form method="post" action="{{ url_for('main.withdraw') }}">
  <input type="hidden" name="acc_id" value="{{ account.id }}">
  <label>金额: <input type="number" step="0.01" min="0" name="amount" required></label>
  <button type="submit">取出</button>
</form>

<h3>转账</h3>
<form method="post" action="{{ url_for('main.transfer') }}">
  <input type="hidden" name="from_acc" value="{{ account.id }}">
  <label>对方银行卡号: <input type="text" name="to_bn" required></label><br>
  <label>金额: <input type="number" step="0.01" min="0" name="amount" required></label><br>
  <br>
  <button type="submit">转账</button>
</form>

{% set type_map = {
    'Deposit':      '存入',
    'Withdraw':     '取出',
    'Transfer Out': '转出',
    'Transfer In':  '转入'
} %}

<h3>交易记录</h3>
<table>
  <thead>
  <tr><th>账户ID</th><th>身份证号</th><th>学号</th><th>名称</th><th>时间</th><th>类型</th><th>金额</th><th>备注</th></tr>
  </thead>
  <tbody>
    {% for txn in account.transactions %}
    <tr>
      <td>{{ account.id }}</td>
      <td>{{ current_user.id_card }}</td>
      <td>{{ current_user.student_number }}</td>
      <td>{{ account.name }}</td>
      <td>{{ txn.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
      <td>
        {{ type_map.get(txn.t_type, txn.t_type) }}
        {%- if txn.other_account -%}
        <br>
        <small>对端卡号：{{ txn.other_account.bank_number }}</small>
        {%- endif -%}
      </td>
      <td>{{ txn.amount }}</td>
      <td>{{ txn.note if txn.note is defined else (txn.other_account_id or '') }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<br>
<a href="{{ url_for('main.dashboard') }}">返回首页</a>
{% endblock %}


